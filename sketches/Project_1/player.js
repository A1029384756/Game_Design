class Player extends GameObject {
  /** @param {Vec2} pos 
    * @param sprite
    */
  constructor(pos, sprite = createImage(0, 0)) {
    super(pos)
    this.speed = 5
    this.shot_delay_ms = 500
    this.shot_timer = this.shot_delay_ms
    this.collider = new Collider(pos, 30)
    this.sprite = sprite
  }

  update() {
    super.update()
    this.collider.pos = this.pos

    if (keyIsDown(65) && this.pos.x > 15) {
      this.pos.x -= this.speed
    }

    if (keyIsDown(68) && this.pos.x < PANE_WIDTH - 15) {
      this.pos.x += this.speed
    }

    if (keyIsDown(32)) {
      this.shoot()
    }
    this.shot_timer += deltaTime
  }

  draw() {
    image(this.sprite, this.pos.x - this.sprite.width / 2, this.pos.y - this.sprite.height / 2)
  }

  shoot() {
    if (this.shot_timer >= this.shot_delay_ms) {
      this.shot_timer = 0
      game.objects.push(
        new Bullet(
          new Vec2(this.pos.x, this.pos.y - 21),
          new Vec2(0, -1),
          game.bullet_sprite
        )
      )
    }
  }
}

function create_player_sprite() {
  let buf = createGraphics(32, 32)
  buf.noStroke()
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 0, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 0, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 2, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 2, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 4, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 4, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(12, 6, 2, 2)
  buf.fill('rgba(215,254,251,255)')
  buf.rect(14, 6, 2, 2)
  buf.fill('rgba(163,239,234,255)')
  buf.rect(16, 6, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(18, 6, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 8, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(10, 8, 2, 2)
  buf.fill('rgba(163,239,234,255)')
  buf.rect(12, 8, 2, 2)
  buf.fill('rgba(163,239,234,255)')
  buf.rect(14, 8, 2, 2)
  buf.fill('rgba(215,254,251,255)')
  buf.rect(16, 8, 2, 2)
  buf.fill('rgba(163,239,234,255)')
  buf.rect(18, 8, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(20, 8, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 8, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(6, 10, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(8, 10, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(12, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(18, 10, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 10, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(22, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(24, 10, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(4, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(6, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(8, 12, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(10, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(12, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(14, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(16, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(18, 12, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(20, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(22, 12, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(24, 12, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(26, 12, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(2, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(4, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(6, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(12, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(18, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(24, 14, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(26, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(28, 14, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(0, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(2, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(4, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(6, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(12, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(14, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(16, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(18, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(24, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(26, 16, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(28, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(30, 16, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(0, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(2, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(4, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(6, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(8, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(10, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(12, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(14, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(16, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(18, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(20, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(22, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(24, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(26, 18, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(28, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(30, 18, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(2, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(4, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 20, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(12, 20, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(14, 20, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(16, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(18, 20, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(26, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(28, 20, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 22, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 22, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(12, 22, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(14, 22, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(16, 22, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(18, 22, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 22, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 22, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(6, 24, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(8, 24, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(10, 24, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(12, 24, 2, 2)
  buf.fill('rgba(222,137,11,255)')
  buf.rect(14, 24, 2, 2)
  buf.fill('rgba(222,137,11,255)')
  buf.rect(16, 24, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(18, 24, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(20, 24, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(22, 24, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(24, 24, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(6, 26, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(8, 26, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(10, 26, 2, 2)
  buf.fill('rgba(222,137,11,255)')
  buf.rect(14, 26, 2, 2)
  buf.fill('rgba(222,137,11,255)')
  buf.rect(16, 26, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(20, 26, 2, 2)
  buf.fill('rgba(255,255,255,255)')
  buf.rect(22, 26, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(24, 26, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(8, 28, 2, 2)
  buf.fill('rgba(0,0,0,255)')
  buf.rect(22, 28, 2, 2)

  return buf.get(0, 0, buf.width, buf.height)
}
